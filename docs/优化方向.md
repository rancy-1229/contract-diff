# åˆåŒå·®å¼‚å¯¹æ¯”ç³»ç»Ÿä¼˜åŒ–æ–¹å‘

## ğŸ¨ å‰ç«¯ä½“éªŒä¼˜åŒ–

### 1. PDFæ¸²æŸ“ä¸äº¤äº’ä¼˜åŒ–
- **å‰ç«¯PDFæ¸²æŸ“**: ä½¿ç”¨PDF.jsç›´æ¥åœ¨å‰ç«¯æ¸²æŸ“PDFï¼Œæ— éœ€é¢„ç”Ÿæˆå›¾ç‰‡
- **æµç•…ç¿»é¡µä½“éªŒ**: âœ… å·²å®ç° - æ”¯æŒä¸‹æ»‘ç¿»é¡µï¼Œç±»ä¼¼ç§»åŠ¨ç«¯é˜…è¯»ä½“éªŒ
- **åŠ¨æ€é«˜äº®æ¸²æŸ“**: ğŸš€ è®¡åˆ’å®ç° - å‰ç«¯å®æ—¶æ¸²æŸ“å·®å¼‚é«˜äº®è‰²å—ï¼Œæ”¯æŒå¤šç§é¢œè‰²åŒºåˆ†
- **å·®å¼‚å…³è”å±•ç¤º**: ç‚¹å‡»é«˜äº®è‰²å—æ—¶ï¼Œç”¨åŠ¨æ€è™šçº¿è¿æ¥ç›¸å…³å·®å¼‚ï¼Œç›´è§‚æ˜¾ç¤ºä¿®æ”¹å…³ç³»
- **ç¼©æ”¾ä¸å®šä½**: æ”¯æŒPDFç¼©æ”¾ï¼Œç‚¹å‡»å·®å¼‚è‡ªåŠ¨å®šä½åˆ°å¯¹åº”ä½ç½®

### 2. å›¾ç‰‡OCRè¯†åˆ«å¤„ç†
- **å¤šæ ¼å¼æ”¯æŒ**: æ”¯æŒJPGã€PNGã€PDFç­‰å›¾ç‰‡æ ¼å¼ä¸Šä¼ 
- **OCRæ–‡å­—è¯†åˆ«**: é›†æˆOCRæœåŠ¡ï¼Œè‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—å†…å®¹
- **è¯†åˆ«ç»“æœç¼–è¾‘**: å…è®¸ç”¨æˆ·æ‰‹åŠ¨ä¿®æ­£OCRè¯†åˆ«é”™è¯¯
- **æ‰¹é‡å¤„ç†**: æ”¯æŒæ‰¹é‡ä¸Šä¼ å›¾ç‰‡è¿›è¡ŒOCRå¤„ç†

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 3. å®æ—¶é€šä¿¡ä¼˜åŒ–
- **WebSocketé›†æˆ**: æ›¿ä»£è½®è¯¢æœºåˆ¶ï¼Œå®ç°AIå®¡æŸ¥ç»“æœçš„å®æ—¶æ¨é€
- **è¿›åº¦æ¡æ˜¾ç¤º**: æ˜¾ç¤ºAIå®¡æŸ¥çš„è¯¦ç»†è¿›åº¦ï¼ˆå¦‚ï¼šæ­£åœ¨åˆ†æç¬¬Xä¸ªå·®å¼‚...ï¼‰
- **å®æ—¶é€šçŸ¥**: å®¡æŸ¥å®Œæˆæ—¶æ¨é€é€šçŸ¥ï¼Œæ”¯æŒæµè§ˆå™¨é€šçŸ¥API

### 4. ç¼“å­˜ä¸å­˜å‚¨ä¼˜åŒ–
- **Redisç¼“å­˜**: ç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œæå‡å“åº”é€Ÿåº¦
- **CDNåŠ é€Ÿ**: é™æ€èµ„æºä½¿ç”¨CDNåˆ†å‘
- **æ•°æ®åº“ä¼˜åŒ–**: æ·»åŠ ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **æ–‡ä»¶å­˜å‚¨**: æ”¯æŒäº‘å­˜å‚¨ï¼ˆAWS S3ã€é˜¿é‡Œäº‘OSSç­‰ï¼‰

## ğŸ¤– AIåŠŸèƒ½å¢å¼º

### 5. å¤šæ¨¡å‹æ”¯æŒ
- **æ¨¡å‹åˆ‡æ¢**: æ”¯æŒåˆ‡æ¢ä¸åŒçš„AIæ¨¡å‹ï¼ˆGPTã€Claudeã€è±†åŒ…ç­‰ï¼‰
- **æ¨¡å‹å¯¹æ¯”**: åŒæ—¶ä½¿ç”¨å¤šä¸ªæ¨¡å‹è¿›è¡Œå®¡æŸ¥ï¼Œå¯¹æ¯”ç»“æœå·®å¼‚
- **è‡ªå®šä¹‰æ¨¡å‹**: æ”¯æŒç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰æ¨¡å‹è¿›è¡Œå®¡æŸ¥

### 6. æ™ºèƒ½åˆ†æå¢å¼º
- **é£é™©ç­‰çº§ç»†åŒ–**: å¢åŠ æ›´å¤šé£é™©ç­‰çº§ï¼ˆæé«˜ã€é«˜ã€ä¸­ã€ä½ã€æä½ï¼‰
- **åˆè§„æ£€æŸ¥**: é›†æˆæ³•å¾‹æ¡æ–‡æ•°æ®åº“ï¼Œè¿›è¡Œæ›´ç²¾ç¡®çš„åˆè§„æ€§æ£€æŸ¥
- **å†å²å¯¹æ¯”**: æ”¯æŒä¸å†å²åˆåŒç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”åˆ†æ
- **è¶‹åŠ¿åˆ†æ**: åˆ†æåˆåŒä¿®æ”¹è¶‹åŠ¿ï¼Œè¯†åˆ«å¸¸è§é£é™©ç‚¹

## ğŸ“Š æ•°æ®åˆ†æä¸æŠ¥å‘Š

### 7. æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ
- **è‡ªåŠ¨æŠ¥å‘Š**: ç”Ÿæˆè¯¦ç»†çš„å·®å¼‚åˆ†ææŠ¥å‘Š
- **é£é™©è¯„ä¼°**: æ•´ä½“é£é™©è¯„ä¼°å’Œé£é™©ç‚¹æ±‡æ€»
- **ä¿®æ”¹å»ºè®®**: åŸºäºAIåˆ†æç”Ÿæˆå…·ä½“çš„ä¿®æ”¹å»ºè®®
- **å¯¼å‡ºåŠŸèƒ½**: æ”¯æŒPDFã€Wordã€Excelæ ¼å¼å¯¼å‡º

### 8. æ•°æ®å¯è§†åŒ–
- **å·®å¼‚ç»Ÿè®¡å›¾è¡¨**: é¥¼å›¾ã€æŸ±çŠ¶å›¾å±•ç¤ºå·®å¼‚åˆ†å¸ƒ
- **é£é™©çƒ­åŠ›å›¾**: å¯è§†åŒ–æ˜¾ç¤ºåˆåŒä¸­çš„é£é™©åˆ†å¸ƒ
- **æ—¶é—´çº¿åˆ†æ**: æ˜¾ç¤ºåˆåŒä¿®æ”¹çš„æ—¶é—´çº¿
- **å¯¹æ¯”å†å²**: å±•ç¤ºå¤šæ¬¡å¯¹æ¯”çš„å†å²è®°å½•

## ğŸ”§ ç³»ç»ŸåŠŸèƒ½æ‰©å±•

### 9. ç”¨æˆ·æƒé™ç®¡ç†
- **å¤šç”¨æˆ·æ”¯æŒ**: æ”¯æŒå¤šç”¨æˆ·åä½œ
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„æƒé™ç®¡ç†ï¼ˆæŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ é™¤ç­‰ï¼‰
- **å›¢é˜Ÿåä½œ**: æ”¯æŒå›¢é˜Ÿå…±äº«å’Œåä½œå®¡æŸ¥
- **å®¡è®¡æ—¥å¿—**: è®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—

### 10. æ¨¡æ¿ä¸è§„åˆ™å¼•æ“
- **åˆåŒæ¨¡æ¿**: æä¾›å¸¸ç”¨åˆåŒæ¨¡æ¿
- **è‡ªå®šä¹‰è§„åˆ™**: ç”¨æˆ·å¯è‡ªå®šä¹‰å®¡æŸ¥è§„åˆ™
- **è§„åˆ™åº“**: å»ºç«‹æ³•å¾‹è§„åˆ™çŸ¥è¯†åº“
- **è§„åˆ™æµ‹è¯•**: æ”¯æŒè§„åˆ™æµ‹è¯•å’ŒéªŒè¯

## ğŸŒ é›†æˆä¸æ‰©å±•

### 11. ç¬¬ä¸‰æ–¹é›†æˆ
- **ç”µå­ç­¾å**: é›†æˆç”µå­ç­¾åæœåŠ¡
- **æ³•å¾‹æ•°æ®åº“**: è¿æ¥æ³•å¾‹æ¡æ–‡æ•°æ®åº“
- **ç¿»è¯‘æœåŠ¡**: æ”¯æŒå¤šè¯­è¨€åˆåŒå¯¹æ¯”
- **äº‘å­˜å‚¨**: é›†æˆä¸»æµäº‘å­˜å‚¨æœåŠ¡

### 12. APIå¼€æ”¾
- **RESTful API**: æä¾›å®Œæ•´çš„APIæ¥å£
- **Webhookæ”¯æŒ**: æ”¯æŒäº‹ä»¶å›è°ƒ
- **SDKå¼€å‘**: æä¾›å¤šè¯­è¨€SDK
- **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒç¬¬ä¸‰æ–¹æ’ä»¶æ‰©å±•

## ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ

### 13. å“åº”å¼è®¾è®¡
- **ç§»åŠ¨ç«¯é€‚é…**: ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤ºæ•ˆæœ
- **è§¦æ‘¸æ“ä½œ**: æ”¯æŒè§¦æ‘¸æ‰‹åŠ¿æ“ä½œ
- **ç¦»çº¿åŠŸèƒ½**: æ”¯æŒç¦»çº¿æŸ¥çœ‹å·²ä¸‹è½½çš„å¯¹æ¯”ç»“æœ
- **PWAæ”¯æŒ**: æ”¯æŒæ¸è¿›å¼Webåº”ç”¨

## ğŸ”’ å®‰å…¨ä¸åˆè§„

### 14. æ•°æ®å®‰å…¨
- **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **è®¿é—®æ§åˆ¶**: ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶æœºåˆ¶
- **æ•°æ®å¤‡ä»½**: è‡ªåŠ¨æ•°æ®å¤‡ä»½å’Œæ¢å¤
- **åˆè§„è®¤è¯**: é€šè¿‡ç›¸å…³å®‰å…¨è®¤è¯

### 15. éšç§ä¿æŠ¤
- **æ•°æ®è„±æ•**: æ”¯æŒæ•æ„Ÿä¿¡æ¯è„±æ•
- **æƒé™å®¡è®¡**: è¯¦ç»†çš„æƒé™ä½¿ç”¨å®¡è®¡
- **æ•°æ®åˆ é™¤**: æ”¯æŒæ•°æ®å®Œå…¨åˆ é™¤
- **éšç§æ”¿ç­–**: å®Œå–„çš„éšç§ä¿æŠ¤æ”¿ç­–

## ğŸ¯ çŸ­æœŸä¼˜åŒ–ç›®æ ‡ï¼ˆ1-3ä¸ªæœˆï¼‰

1. **å‰ç«¯é«˜äº®æ¸²æŸ“**: ğŸš€ è®¡åˆ’å®ç° - ä»åç«¯æ¸²æŸ“æ”¹ä¸ºå‰ç«¯æ¸²æŸ“ï¼Œæå‡äº¤äº’ä½“éªŒ
2. **WebSocketå®æ—¶é€šä¿¡**: æ›¿ä»£è½®è¯¢æœºåˆ¶
3. **Redisç¼“å­˜**: æå‡ç³»ç»Ÿå“åº”é€Ÿåº¦
4. **ç§»åŠ¨ç«¯é€‚é…**: âœ… å·²å®ç° - æ»‘åŠ¨ç¿»é¡µåŠŸèƒ½ï¼Œä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º

## ğŸš€ ä¸­æœŸä¼˜åŒ–ç›®æ ‡ï¼ˆ3-6ä¸ªæœˆï¼‰

1. **å¤šæ¨¡å‹æ”¯æŒ**: é›†æˆå¤šä¸ªAIæ¨¡å‹
2. **æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š
3. **ç”¨æˆ·æƒé™ç®¡ç†**: å®ç°å¤šç”¨æˆ·åä½œ
4. **OCRå›¾ç‰‡è¯†åˆ«**: æ”¯æŒå›¾ç‰‡æ–‡å­—è¯†åˆ«

## ğŸŒŸ é•¿æœŸä¼˜åŒ–ç›®æ ‡ï¼ˆ6-12ä¸ªæœˆï¼‰

1. **è§„åˆ™å¼•æ“**: å»ºç«‹å®Œæ•´çš„æ³•å¾‹è§„åˆ™åº“
2. **ç¬¬ä¸‰æ–¹é›†æˆ**: é›†æˆç”µå­ç­¾åç­‰æœåŠ¡
3. **APIå¼€æ”¾**: æä¾›å®Œæ•´çš„å¼€æ”¾å¹³å°
4. **ä¼ä¸šçº§åŠŸèƒ½**: æ”¯æŒå¤§è§„æ¨¡ä¼ä¸šä½¿ç”¨

---

## ğŸ¨ å‰ç«¯é«˜äº®æ¸²æŸ“æŠ€æœ¯æ–¹æ¡ˆ

### æŠ€æœ¯èƒŒæ™¯

å½“å‰ç³»ç»Ÿé‡‡ç”¨åç«¯æ¸²æŸ“æ–¹å¼ï¼šåç«¯ä½¿ç”¨PyMuPDFåœ¨PDFé¡µé¢ä¸Šç»˜åˆ¶é«˜äº®è‰²å—ï¼Œç„¶åç”Ÿæˆå¸¦é«˜äº®çš„PNGå›¾ç‰‡è¿”å›ç»™å‰ç«¯ã€‚è¿™ç§æ–¹å¼å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **æ€§èƒ½é—®é¢˜**: æ¯æ¬¡å·®å¼‚å˜åŒ–éƒ½éœ€è¦é‡æ–°ç”Ÿæˆå›¾ç‰‡
2. **äº¤äº’é™åˆ¶**: æ— æ³•åŠ¨æ€è°ƒæ•´é«˜äº®æ ·å¼ã€é¢œè‰²ã€é€æ˜åº¦
3. **å­˜å‚¨å‹åŠ›**: éœ€è¦å­˜å‚¨å¤§é‡å¸¦é«˜äº®çš„å›¾ç‰‡æ–‡ä»¶
4. **å“åº”å»¶è¿Ÿ**: å›¾ç‰‡ç”Ÿæˆå’Œä¼ è¾“éœ€è¦æ—¶é—´

### å‰ç«¯æ¸²æŸ“æ–¹æ¡ˆ

#### 1. æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯æœåŠ¡      â”‚    â”‚   å‰ç«¯ç»„ä»¶       â”‚    â”‚   ç”¨æˆ·äº¤äº’      â”‚
â”‚                 â”‚    â”‚                  â”‚    â”‚                 â”‚
â”‚ â€¢ è¿”å›åŸå§‹PDF   â”‚â”€â”€â”€â–¶â”‚ â€¢ PDF.jsæ¸²æŸ“     â”‚â”€â”€â”€â–¶â”‚ â€¢ ç‚¹å‡»é«˜äº®      â”‚
â”‚ â€¢ è¿”å›å·®å¼‚æ•°æ®  â”‚    â”‚ â€¢ Canvasç»˜åˆ¶     â”‚    â”‚ â€¢ æ‚¬åœæ•ˆæœ      â”‚
â”‚ â€¢ è¿”å›åæ ‡ä¿¡æ¯  â”‚    â”‚ â€¢ åŠ¨æ€é«˜äº®       â”‚    â”‚ â€¢ ç¼©æ”¾æ“ä½œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. æ ¸å¿ƒç»„ä»¶è®¾è®¡

##### 2.1 PDFViewerç»„ä»¶
```typescript
interface PDFViewerProps {
  pdfUrl: string;
  diffList: DiffItem[];
  currentPage: number;
  onPageChange: (page: number) => void;
  onDiffClick: (diff: DiffItem) => void;
}

const PDFViewer: React.FC<PDFViewerProps> = ({
  pdfUrl,
  diffList,
  currentPage,
  onPageChange,
  onDiffClick
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const pdfRef = useRef<PDFDocumentProxy | null>(null);
  const [scale, setScale] = useState(1.0);
  
  // PDF.jsæ¸²æŸ“é€»è¾‘
  // Canvasé«˜äº®ç»˜åˆ¶é€»è¾‘
  // äº¤äº’äº‹ä»¶å¤„ç†
};
```

##### 2.2 HighlightRendererç»„ä»¶
```typescript
interface HighlightRendererProps {
  diffList: DiffItem[];
  pageIndex: number;
  scale: number;
  onDiffClick: (diff: DiffItem) => void;
}

const HighlightRenderer: React.FC<HighlightRendererProps> = ({
  diffList,
  pageIndex,
  scale,
  onDiffClick
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  
  // é«˜äº®ç»˜åˆ¶é€»è¾‘
  const renderHighlights = useCallback(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // æ¸…é™¤ç”»å¸ƒ
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ç»˜åˆ¶é«˜äº®è‰²å—
    diffList
      .filter(diff => diff.page_index === pageIndex)
      .forEach(diff => {
        drawHighlight(ctx, diff, scale);
      });
  }, [diffList, pageIndex, scale]);
  
  return (
    <canvas
      ref={canvasRef}
      style={{
        position: 'absolute',
        top: 0,
        left: 0,
        pointerEvents: 'auto',
        zIndex: 10
      }}
      onClick={handleCanvasClick}
    />
  );
};
```

#### 3. æ•°æ®æµè®¾è®¡

##### 3.1 åç«¯APIè°ƒæ•´
```typescript
// å½“å‰APIè¿”å›
interface ComparisonResponse {
  standard_images: string[];  // å¸¦é«˜äº®çš„å›¾ç‰‡URL
  target_images: string[];
  diff_list: DiffItem[];
}

// æ–°APIè¿”å›
interface ComparisonResponse {
  standard_pdf_url: string;   // åŸå§‹PDFæ–‡ä»¶URL
  target_pdf_url: string;     // åŸå§‹PDFæ–‡ä»¶URL
  diff_list: DiffItem[];      // å·®å¼‚æ•°æ®ï¼ˆåŒ…å«åæ ‡ä¿¡æ¯ï¼‰
  page_count: number;         // æ€»é¡µæ•°
}
```

##### 3.2 å·®å¼‚æ•°æ®ç»“æ„
```typescript
interface DiffItem {
  element_id: string;
  status: 'ADD' | 'DELETE' | 'MODIFY' | 'MOVE';
  page_index: number;
  old_text?: string;
  new_text?: string;
  
  // åæ ‡ä¿¡æ¯
  coordinates: {
    // PDFåæ ‡ï¼ˆç‚¹å•ä½ï¼‰
    pdf_bbox: [number, number, number, number]; // [x0, y0, x1, y1]
    
    // å­—ç¬¦çº§åæ ‡
    char_coordinates: Array<{
      char: string;
      bbox: [number, number, number, number];
      char_index: number;
    }>;
    
    // é¡µé¢ä¿¡æ¯
    page_info: {
      width: number;   // é¡µé¢å®½åº¦ï¼ˆç‚¹ï¼‰
      height: number;  // é¡µé¢é«˜åº¦ï¼ˆç‚¹ï¼‰
      scale: number;   // æ¸²æŸ“ç¼©æ”¾æ¯”ä¾‹
    };
  };
  
  // æ ·å¼é…ç½®
  style: {
    color: string;        // é«˜äº®é¢œè‰²
    opacity: number;      // é€æ˜åº¦
    stroke_color: string; // è¾¹æ¡†é¢œè‰²
    stroke_width: number; // è¾¹æ¡†å®½åº¦
  };
}
```

#### 4. å®ç°æ­¥éª¤

##### é˜¶æ®µ1: åŸºç¡€æ¶æ„æ­å»º
1. **å®‰è£…ä¾èµ–**
   ```bash
   npm install pdfjs-dist react-pdf
   ```

2. **åˆ›å»ºPDFViewerç»„ä»¶**
   - é›†æˆPDF.js
   - å®ç°PDFé¡µé¢æ¸²æŸ“
   - æ·»åŠ ç¼©æ”¾å’Œç¿»é¡µåŠŸèƒ½

3. **åˆ›å»ºHighlightRendererç»„ä»¶**
   - Canvasé«˜äº®ç»˜åˆ¶
   - åæ ‡è½¬æ¢é€»è¾‘
   - ç‚¹å‡»äº‹ä»¶å¤„ç†

##### é˜¶æ®µ2: é«˜äº®æ¸²æŸ“å®ç°
1. **åæ ‡è½¬æ¢ç³»ç»Ÿ**
   ```typescript
   class CoordinateTransformer {
     // PDFåæ ‡è½¬Canvasåæ ‡
     static pdfToCanvas(
       pdfCoords: [number, number, number, number],
       pageWidth: number,
       pageHeight: number,
       canvasWidth: number,
       canvasHeight: number,
       scale: number
     ): [number, number, number, number] {
       const [x0, y0, x1, y1] = pdfCoords;
       
       // è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
       const scaleX = (canvasWidth / pageWidth) * scale;
       const scaleY = (canvasHeight / pageHeight) * scale;
       
       return [
         x0 * scaleX,
         y0 * scaleY,
         x1 * scaleX,
         y1 * scaleY
       ];
     }
   }
   ```

2. **é«˜äº®ç»˜åˆ¶é€»è¾‘**
   ```typescript
   const drawHighlight = (
     ctx: CanvasRenderingContext2D,
     diff: DiffItem,
     scale: number
   ) => {
     const { coordinates, style } = diff;
     const [x0, y0, x1, y1] = coordinates.pdf_bbox;
     
     // è®¾ç½®æ ·å¼
     ctx.fillStyle = style.color;
     ctx.globalAlpha = style.opacity;
     ctx.strokeStyle = style.stroke_color;
     ctx.lineWidth = style.stroke_width;
     
     // ç»˜åˆ¶é«˜äº®çŸ©å½¢
     ctx.fillRect(x0, y0, x1 - x0, y1 - y0);
     ctx.strokeRect(x0, y0, x1 - x0, y1 - y0);
     
     // é‡ç½®é€æ˜åº¦
     ctx.globalAlpha = 1.0;
   };
   ```

##### é˜¶æ®µ3: äº¤äº’åŠŸèƒ½å®ç°
1. **ç‚¹å‡»æ£€æµ‹**
   ```typescript
   const handleCanvasClick = (event: MouseEvent) => {
     const rect = canvasRef.current!.getBoundingClientRect();
     const x = event.clientX - rect.left;
     const y = event.clientY - rect.top;
     
     // æ£€æµ‹ç‚¹å‡»çš„é«˜äº®åŒºåŸŸ
     const clickedDiff = findClickedDiff(x, y, diffList, scale);
     if (clickedDiff) {
       onDiffClick(clickedDiff);
     }
   };
   ```

2. **æ‚¬åœæ•ˆæœ**
   ```typescript
   const [hoveredDiff, setHoveredDiff] = useState<DiffItem | null>(null);
   
   const handleMouseMove = (event: MouseEvent) => {
     const rect = canvasRef.current!.getBoundingClientRect();
     const x = event.clientX - rect.left;
     const y = event.clientY - rect.top;
     
     const hovered = findClickedDiff(x, y, diffList, scale);
     setHoveredDiff(hovered);
   };
   ```

##### é˜¶æ®µ4: æ€§èƒ½ä¼˜åŒ–
1. **è™šæ‹ŸåŒ–æ¸²æŸ“**
   - åªæ¸²æŸ“å¯è§é¡µé¢çš„é«˜äº®
   - ä½¿ç”¨Intersection Observer API

2. **Canvasä¼˜åŒ–**
   - ä½¿ç”¨OffscreenCanvasè¿›è¡Œç¦»å±æ¸²æŸ“
   - å®ç°é«˜äº®ç¼“å­˜æœºåˆ¶

3. **å†…å­˜ç®¡ç†**
   - åŠæ—¶æ¸…ç†Canvasä¸Šä¸‹æ–‡
   - ä½¿ç”¨WeakMapç¼“å­˜è®¡ç®—ç»“æœ

#### 5. æŠ€æœ¯ä¼˜åŠ¿

##### 5.1 æ€§èƒ½ä¼˜åŠ¿
- **å®æ—¶æ¸²æŸ“**: æ— éœ€ç­‰å¾…åç«¯å›¾ç‰‡ç”Ÿæˆ
- **å†…å­˜æ•ˆç‡**: ä¸å­˜å‚¨å¤§é‡å›¾ç‰‡æ–‡ä»¶
- **ç½‘ç»œä¼˜åŒ–**: å‡å°‘å›¾ç‰‡ä¼ è¾“é‡

##### 5.2 äº¤äº’ä¼˜åŠ¿
- **åŠ¨æ€æ ·å¼**: æ”¯æŒå®æ—¶è°ƒæ•´é«˜äº®é¢œè‰²ã€é€æ˜åº¦
- **å“åº”å¼**: æ”¯æŒç¼©æ”¾ã€æ—‹è½¬ç­‰æ“ä½œ
- **æµç•…ä½“éªŒ**: 60fpsçš„æ¸²æŸ“æ€§èƒ½

##### 5.3 å¼€å‘ä¼˜åŠ¿
- **ç»„ä»¶åŒ–**: é«˜åº¦å¯å¤ç”¨çš„ç»„ä»¶è®¾è®¡
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°çš„äº¤äº’åŠŸèƒ½
- **ç»´æŠ¤æ€§**: å‰åç«¯èŒè´£åˆ†ç¦»ï¼Œä»£ç æ›´æ¸…æ™°

#### 6. æ³¨æ„äº‹é¡¹

##### 6.1 åæ ‡ç³»ç»Ÿ
- **PDFåæ ‡**: ä»¥ç‚¹ä¸ºå•ä½çš„ç»å¯¹åæ ‡
- **Canvasåæ ‡**: åƒç´ åæ ‡ï¼Œéœ€è¦è€ƒè™‘DPI
- **ç¼©æ”¾å¤„ç†**: åŠ¨æ€è°ƒæ•´åæ ‡è½¬æ¢æ¯”ä¾‹

##### 6.2 æµè§ˆå™¨å…¼å®¹æ€§
- **PDF.jsç‰ˆæœ¬**: ä½¿ç”¨ç¨³å®šç‰ˆæœ¬ï¼Œæ³¨æ„APIå˜åŒ–
- **Canvasæ”¯æŒ**: ç¡®ä¿ç›®æ ‡æµè§ˆå™¨æ”¯æŒCanvas 2D
- **å†…å­˜é™åˆ¶**: å¤§æ–‡ä»¶å¯èƒ½å¯¼è‡´å†…å­˜ä¸è¶³

##### 6.3 æ€§èƒ½è€ƒè™‘
- **æ¸²æŸ“é¢‘ç‡**: é¿å…é¢‘ç¹é‡ç»˜
- **äº‹ä»¶å¤„ç†**: ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµ
- **èµ„æºç®¡ç†**: åŠæ—¶é‡Šæ”¾PDFå’ŒCanvasèµ„æº

##### 6.4 é”™è¯¯å¤„ç†
- **PDFåŠ è½½å¤±è´¥**: æä¾›é™çº§æ–¹æ¡ˆ
- **åæ ‡é”™è¯¯**: å®¹é”™å¤„ç†
- **å†…å­˜æº¢å‡º**: ç›‘æ§å’Œé¢„è­¦

#### 7. è¿ç§»ç­–ç•¥

##### 7.1 æ¸è¿›å¼è¿ç§»
1. **å¹¶è¡Œè¿è¡Œ**: æ–°æ—§æ–¹æ¡ˆåŒæ—¶æ”¯æŒ
2. **A/Bæµ‹è¯•**: éƒ¨åˆ†ç”¨æˆ·ä½¿ç”¨æ–°æ–¹æ¡ˆ
3. **é€æ­¥åˆ‡æ¢**: æ ¹æ®åé¦ˆé€æ­¥è¿ç§»

##### 7.2 æ•°æ®å…¼å®¹
- **APIç‰ˆæœ¬æ§åˆ¶**: æ”¯æŒæ–°æ—§APIæ ¼å¼
- **æ•°æ®è½¬æ¢**: æä¾›æ•°æ®æ ¼å¼è½¬æ¢å·¥å…·
- **å›æ»šæœºåˆ¶**: æ”¯æŒå¿«é€Ÿå›æ»šåˆ°æ—§æ–¹æ¡ˆ

#### 8. æµ‹è¯•ç­–ç•¥

##### 8.1 å•å…ƒæµ‹è¯•
- åæ ‡è½¬æ¢å‡½æ•°æµ‹è¯•
- é«˜äº®ç»˜åˆ¶é€»è¾‘æµ‹è¯•
- äº‹ä»¶å¤„ç†æµ‹è¯•

##### 8.2 é›†æˆæµ‹è¯•
- PDFåŠ è½½å’Œæ¸²æŸ“æµ‹è¯•
- é«˜äº®æ˜¾ç¤ºæµ‹è¯•
- äº¤äº’åŠŸèƒ½æµ‹è¯•

##### 8.3 æ€§èƒ½æµ‹è¯•
- å¤§æ–‡ä»¶æ¸²æŸ“æ€§èƒ½
- å†…å­˜ä½¿ç”¨ç›‘æ§
- å“åº”æ—¶é—´æµ‹è¯•

---

*æœ¬æ–‡æ¡£å°†æ ¹æ®é¡¹ç›®è¿›å±•å’Œç”¨æˆ·åé¦ˆæŒç»­æ›´æ–°*
